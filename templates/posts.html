{% for post, user in posts %}
<div class="flex flex-col align-middle border-b-2 border-gray-700 p-1">
    <form class="flex" action="/{{user.username}}" method="get">
        <button type="submit">
            <img src="data:image/png;base64,{{ user.profile_picture.decode('utf-8') }}" class="rounded-full max-h-10 hover:border-4 hover:border-violet-600 duration-75 ease-in">
        </button>
        <button type="submit" class="text-xl text-blue-300 mx-4 hover:text-purple-400 border-b-2 border-gray-900 hover:border-purple-400 duration-75 ease-in">
            {{user.username}}
        </button>
    </form>
    <p class="p-2 text-xl">{{post.text}}</p>
    {% if post.image != None %}
    <div class="bg-black rounded-md mt-6 p-2">
        <img src="data:image/png;base64,{{ post.image.decode('utf-8') }}" class="max-h-96 max-w-96 relative left-1/2 -translate-x-1/2 border-2 border-black">
    </div>
    {% endif %}
    <div class="flex flex-row justify-evenly">
        <button class="comment text-2xl hover:text-violet-600 duration-75 ease-in" value="{{post.post_id}}">
            <i class="fa-solid fa-comment"></i>
        </button>
        <form action="/{{post.post_id}}" class="text-2xl hover:text-violet-600 duration-75 ease-in">
            <button>
                <i class="fa-solid fa-comments"></i>
            </button>
        </form>
        <form action="/{{post.post_id}}/like" class="like-button text-2xl hover:text-violet-600 duration-75 ease-in flex ">
            <button type="submit" value="{{user.username}}">
                <i class="fa-solid fa-heart"></i>
            </button>
            <p class="px-1">{{post.likes}}</p>
        </form>
    </div>
</div>
{% endfor %}
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  $(document).ready(() => {
    $(".like-button").click((event) => {
      event.preventDefault();
      const form = $(event.target).closest("form");
      const endpoint = form.attr("action");
      const username = form.find("button").val();
      $.ajax({
        type: "POST",
        url: endpoint,
        data: { username: username },
        success: (data) => {
          form.find("p").text(data.likes);
        },
        error: () => {
          alert("Failed to like the post!");
        },
      });
    });
    $(".comment").click((event) => {
      var answered_post = $(event.target).closest("button").val();
      alert(answered_post);
      let modal = $("#modal");
      if (modal.hasClass("hidden")) {
        modal.removeClass("hidden");
      } else {
        modal.addClass("hidden");
      }
    })
  });
</script>
